<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Goridezz ‚Äì Booking</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="icon" href="logo.png" type="image/jpeg">


  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>



  <style>
    /* RESET */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Poppins", sans-serif;
    }

    /* BACKGROUND THEME */
    body {
      background: radial-gradient(circle at top, #1b1b1b 0%, #020202 55%, #000 100%);
      min-height: 100vh;
      padding-bottom: 60px;
      overflow-x: hidden;
      position: relative;
    }

    /* GOLD STRIPES */
    .shape-left,
    .shape-right {
      position: fixed;
      top: -40px;
      width: 330px;
      height: 150%;
      opacity: 0.55;
      z-index: 1;
      filter: blur(1px);
    }

    .shape-left {
      left: -100px;
      background: linear-gradient(160deg, rgba(255, 215, 0, 0.18), transparent);
      border-right: 2px solid rgba(255, 215, 0, 0.4);
      pointer-events: none;
    }

    .shape-right {
      right: -100px;
      background: linear-gradient(200deg, rgba(255, 165, 0, 0.25), transparent);
      border-left: 2px solid rgba(255, 185, 0, 0.4);
      pointer-events: none;
    }

    /* GOLD GLOW BEHIND CONTENT */
    body::before,
    body::after {
      content: "";
      position: fixed;
      width: 480px;
      height: 480px;
      left: 50%;
      transform: translateX(-50%);
      filter: blur(95px);
      pointer-events: none;
      z-index: 0;
    }

    body::before {
      top: -160px;
      background: radial-gradient(circle, rgba(255, 215, 0, 0.25), transparent 70%);
    }

    body::after {
      bottom: -160px;
      background: radial-gradient(circle, rgba(255, 165, 0, 0.22), transparent 70%);
    }

    /* FIX HEADER HEIGHT LIKE LOGIN PAGE */
    .premium-header {
      height: 65px !important;
      /* reduced height */
      padding: 0 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;

      background: #0c0c0c;
      border-bottom: 1px solid rgba(255, 215, 0, 0.25);
    }

    /* LOGO SIZE FIX */
    .premium-header .logo {
      font-size: 24px;
      font-weight: 700;
      color: #ffd700;
    }

    /* DOTS BUTTON FIX */
    .menu-dots {
      font-size: 26px;
      color: #ffd700;
      cursor: pointer;
      user-select: none;
    }


    .dots-menu {
      position: absolute;
      top: 60px;
      right: 20px;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 215, 0, 0.3);
      border-radius: 10px;
      backdrop-filter: blur(14px);
      flex-direction: column;
      display: none;
      padding: 12px 0;
      z-index: 200;
    }

    .dots-menu a {
      padding: 10px 18px;
      color: #ffd700;
      text-decoration: none;
      display: block;
      font-weight: 500;
    }

    .dots-menu a:hover {
      background: rgba(255, 215, 0, 0.08);
    }

    /* FIX BOOKING CONTAINER THEME */
    .booking-container {
      width: 92%;
      max-width: 420px;
      margin: 30px auto;
      padding: 35px 25px;

      background: rgba(255, 215, 0, 0.06);
      border: 1px solid rgba(255, 215, 0, 0.25);
      border-radius: 20px;
      backdrop-filter: blur(18px);

      box-shadow:
        0 0 3px rgba(255, 215, 0, 0.35),
        0 0 3px rgba(255, 165, 0, 0.20),
        inset 0 0 3px rgba(255, 215, 0, 0.12);

      animation: fadeIn .8s ease-out;
      position: relative;
      z-index: 5;
    }

    /* HEADING GOLDEN GLOW */
    .booking-container h2 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 28px;
      font-weight: 500;

      background: linear-gradient(90deg, #ffd700, #ffb300);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;

      text-shadow: 0 0 1px rgba(255, 215, 0, 0.6);
    }

    /* LABELS */
    .booking-container label {
      color: #ffd700;
      font-weight: 500;
      margin: 10px 0 5px;
      display: block;
    }

    /* INPUT + TEXTAREA + SELECT */
    .booking-container input,
    .booking-container textarea,
    .booking-container select {
      width: 100%;
      padding: 14px;
      margin-bottom: 12px;

      background: rgba(0, 0, 0, 0.55);
      border: 1px solid rgba(255, 215, 0, 0.35);
      border-radius: 12px;

      color: white;
      font-size: 15px;
      transition: 0.3s;
    }

    .booking-container input:focus,
    .booking-container textarea:focus,
    .booking-container select:focus {
      border-color: #ffd700;
      box-shadow: 0 0 3px rgba(255, 215, 0, 0.10);
      outline: none;
    }

    .booking-container select {
      padding: 18px 14px;
      /* ‚¨ÖÔ∏è increases height */
      line-height: 1.4;
      /* better vertical centering */
      font-size: 15px;
      /* keep readable */

      height: auto;
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;

      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;

      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Prevent options from stretching width */
    /* Dropdown option text */
    .booking-container select option {
      font-size: 10px;
      /* ‚¨ÖÔ∏è smaller font inside dropdown */
    }

    /* BUTTONS */
    .booking-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(45deg, #ffd700, #ffb300);
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 500;
      color: #222;
      cursor: pointer;
      margin-top: 15px;
      transition: 0.3s;
    }

    .booking-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 3px rgba(255, 215, 0, 0.55);
    }

    /* ANIMATION */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .input-error {
      border: 2px solid #ff4d4d !important;
    }

    .field-error {
      color: #ff6b6b;
      font-size: 13px;
      margin-top: -8px;
      margin-bottom: 10px;
      display: none;
    }


    /* POPUP BASE */
    .qr-popup {
      display: none;
      position: fixed;
      z-index: 999;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      justify-content: center;
      align-items: center;
    }

    .qr-box {
      background: rgba(255, 215, 0, 0.08);
      padding: 20px;
      width: 90%;
      max-width: 350px;
      border-radius: 18px;
      border: 1px solid rgba(255, 215, 0, 0.3);
      backdrop-filter: blur(14px);
      text-align: center;
    }

    /* POPUP BUTTONS */
    .qr-confirm-btn {
      width: 100%;
      background: linear-gradient(45deg, #ffd700, #ffb300);
      padding: 12px;
      border: none;
      border-radius: 12px;
      font-weight: 500;
      margin-top: 15px;
      cursor: pointer;
    }

    .qr-close-btn {
      width: 100%;
      margin-top: 10px;
      padding: 12px;
      background: rgba(255, 215, 0, 0.12);
      border: 1px solid rgba(255, 215, 0, 0.2);
      border-radius: 12px;
      color: #ffd700;
    }

    /* GOLDEN CARD (same as login theme) */
    .gold-card {
      width: 92%;
      max-width: 420px;
      padding: 35px 25px;
      margin: 30px auto;
      background: rgba(255, 215, 0, 0.06);
      border: 1px solid rgba(255, 215, 0, 0.25);
      border-radius: 20px;
      backdrop-filter: blur(18px);
      box-shadow:
        0 0 1px rgba(255, 215, 0, 0),
        inset 0 0 1px rgba(255, 215, 0, 0);
      z-index: 4;
      position: relative;
      animation: fadeIn .8s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }



    /* Summary popup bright golden text */
    #summaryPopup .qr-box h3 {
      color: #ffd700;
      font-weight: 400;
      font-size: 22px;
      text-shadow: 0 0 2px rgba(255, 215, 0, 0.8);
    }

    #summaryPopup .qr-box p {
      color: #f5d97a;
      /* brighter gold */
      font-size: 16px;
      font-weight: 400;
    }

    #summaryPopup .qr-box b {
      color: #ffd700 !important;
      font-weight: 400;
      text-shadow: 0 0 2px rgba(255, 215, 0, 1);
    }

    /* Highlight Total Amount line */
    #sTotal {
      color: #ffe34d !important;
      font-size: 22px;
      font-weight: 400;
      text-shadow: 0 0 2px rgba(255, 215, 0, 1);
    }

    /* ===============================
   QR PAYMENT POPUP ‚Äì FIXED UI
================================ */

    .qr-payment-box {
      padding: 25px 20px;
      max-width: 340px;
      border-radius: 20px;
    }

    .qr-title {
      color: #ffd700;
      font-size: 22px;
      font-weight: 500;
      margin-bottom: 15px;
      text-shadow: 0 0 3px rgba(255, 215, 0, 0.7);
    }

    /* QR IMAGE */
    .qr-image-wrapper {
      background: #fff;
      padding: 12px;
      border-radius: 16px;
      margin: 10px auto 15px;
      width: fit-content;
      box-shadow: 0 0 3px rgba(255, 215, 0, 0.4);
    }

    .qr-image-wrapper img {
      width: 200px;
      height: 200px;
      display: block;
    }

    /* Instruction text */
    .qr-instruction {
      color: #ffd700;
      font-size: 14px;
      margin-bottom: 12px;
      line-height: 1.4;
    }

    /* Transaction input */
    .txn-input {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid rgba(255, 215, 0, 0.4);
      background: rgba(0, 0, 0, 0.6);
      color: #ffd700;
      font-size: 15px;
      margin-bottom: 15px;
      text-align: center;
    }

    /* Confirm button */
    .qr-confirm-btn {
      width: 100%;
      padding: 14px;
      font-size: 16px;
      font-weight: 700;
      border-radius: 14px;
    }

    /* Close button */
    .qr-close-btn {
      width: 100%;
      margin-top: 10px;
      padding: 12px;
      font-size: 15px;
      border-radius: 14px;
    }


    /* Deposit container */
    .deposit-options {
      display: flex;
      gap: 14px;
    }

    /* Card */
    .deposit-card {
      flex: 1;
      position: relative;
      padding: 20px 15px 18px;
      border: 1px solid rgba(255, 215, 0, 0.35);
      border-radius: 14px;
      background: rgba(0, 0, 0, 0.4);
      cursor: pointer;
      text-align: center;
      transition: 0.3s;
    }

    /* Hide default radio */
    .deposit-card input {
      display: none;
    }

    /* Small white radio circle (THIS is what you want) */
    .radio-dot {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid #ffd700;
      position: absolute;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      background: transparent;
    }

    /* When selected */
    .deposit-card input:checked+.radio-dot {
      background: #fff;
      box-shadow: 0 0 8px rgba(255, 215, 0, 0, 0.8);
    }

    /* Card glow when selected */
    .deposit-card input:checked~.deposit-text {
      color: #ffd700;
    }

    .deposit-card input:checked {
      display: none;
    }

    .deposit-card:has(input:checked) {
      border-color: #ffd700;
      box-shadow: 0 0 14px rgba(255, 215, 0, 0, 0.4);
    }

    /* Text */
    .deposit-text {
      margin-top: 18px;
      color: #ffd700;
      font-weight: 500;
      line-height: 1.3;
    }
  </style>
</head>

<body>

  <header class="premium-header">
    <div class="logo">Go Ridezz</div>

    <div class="menu-dots" onclick="toggleDotsMenu()">‚ãÆ</div>

    <div class="dots-menu" id="dotsMenu">
      <a href="cars.html">Home</a>
      <a href="mybookings.html">My Bookings</a>

    </div>
  </header>


  <div class="booking-container">
    <h2>Book This Car</h2>
    <div id="formError" style="
    display:none;
    background:rgba(255,0,0,0.12);
    border:1px solid rgba(255,0,0,0.4);
    color:#ff6b6b;
    padding:10px;
    border-radius:10px;
    margin-bottom:15px;
    font-size:14px;
    font-weight:500;
  ">
    </div>
    <form id="bookingForm">

      <input type="hidden" id="carId">

      <!-- NEW FIELDS -->
      <label>Full Name</label>
      <input type="text" id="fullname" placeholder="Enter your full name" required>
      <div class="field-error" id="error-fullname"></div>

      <label>Email Address</label>
      <input type="email" id="email" placeholder="Enter your email address" required>
      <div class="field-error" id="error-email"></div>

      <label>Contact Number</label>
      <input type="text" id="contact" placeholder="Enter your contact number" required>
      <div class="field-error" id="error-contact"></div>

      <label>Permanent Address</label>
      <textarea id="address" placeholder="Enter your full permanent address" required></textarea>
      <div class="field-error" id="error-address"></div>

      <label>Where do you want to visit?</label>
      <input type="text" id="visitPlace" placeholder="Enter your travel destination" required>
      <div class="field-error" id="error-visitPlace"></div>

      <label>Pickup Method</label>
      <select id="pickupMethod" onchange="toggleDeliveryInput()" required>
        <option value="">Select an option</option>
        <option value="self">Take car from our location (Free)</option>
        <option value="delivery">Deliver car to my location (‚Çπ500 extra)</option>
      </select>
      <div class="field-error" id="error-pickupMethod"></div>

      <!-- This will show only if user selects delivery -->
      <div id="deliveryAddressBox" style="display:none;">
        <label>Delivery Address</label>
        <input type="text" id="deliveryAddress" placeholder="Enter delivery address">
      </div>
      <div class="field-error" id="error-deliveryAddress"></div>

      <label>Pickup Date</label>
      <input type="text" id="pickupDate" placeholder="Select Pickup Date" onclick="openCalendar('pickupDate')" readonly>
      <div class="field-error" id="error-pickupDate"></div>

      <label>Pickup Time</label>
      <input type="time" id="pickupTime" required>
      <div class="field-error" id="error-pickupTime"></div>

      <label>Return Date</label>
      <input type="text" id="returnDate" placeholder="Select Return Date" onclick="openCalendar('returnDate')" readonly>
      <div class="field-error" id="error-returnDate"></div>

      <label>Return Time</label>
      <input type="time" id="returnTime" required>
      <div class="field-error" id="error-returnTime"></div>



      <label>Upload Aadhaar (Front & Back)</label>

      <!-- FRONT -->
      <input type="file" id="aadhaarFront" accept="image/*,application/pdf" capture="environment"
        onchange="handleAadhaarFront()">

      <div id="aadhaarStatus" style="margin-top:8px;font-weight:600;color:#ffd700;font-size:14px;">
      </div>

      <div id="aadhaarBackMsg"></div>


      <div id="aadhaarFrontMsg" style="color:#ffd700;font-size:13px;margin-top:6px;">
      </div>

      <!-- BUTTON TO ADD BACK -->
      <button type="button" id="addBackBtn" onclick="openAadhaarBack()" style="
          display:none;
          margin-top:8px;
          background:rgba(255,215,0,0.15);
          border:1px dashed rgba(255,215,0,0.6);
          color:#ffd700;
          padding:10px;
          border-radius:10px;
          width:100%;
          font-weight:600;
          cursor:pointer;
        ">
        ‚ûï Add Second Aadhaar Photo (Back Side)
      </button>

      <input type="file" id="aadhaarBack" accept="image/*,application/pdf" capture="environment" style="display:none">


      <div id="aadhaarBackMsg" style="color:#00ff7f;font-size:13px;margin-top:6px;">
      </div>


      <label>License Number</label>
      <input type="text" id="license" placeholder="Enter License number" required>
      <div class="field-error" id="error-license"></div>

      <label>Upload License Photo</label>
      <input type="file" id="licensePhoto" name="licensePhoto" accept="image/*" ">


      <div id=" licenseStatus" style="color:#ffd700; margin-top:8px; font-weight:600;">
  </div>
  <div class="field-error" id="error-upload"></div>
  <!-- ===============================
   SECURITY DEPOSIT SECTION
================================ -->
  <label>Security Deposit</label>
  <div class="deposit-options">

    <label class="deposit-card">
      <input type="radio" name="depositType" value="bike" onclick="toggleDeposit()">
      <span class="radio-dot"></span>

      <div class="deposit-text">
        Deposit<br><b>Bike</b>
      </div>
    </label>
    <div class="field-error" id="error-depositType"></div>

    <label class="deposit-card">
      <input type="radio" name="depositType" value="cash" onclick="toggleDeposit()">
      <span class="radio-dot"></span>

      <div class="deposit-text">
        Deposit<br><b>‚Çπ10000</b>
      </div>
    </label>

  </div>
  <div class="field-error" id="error"></div>


  <!-- BIKE RC UPLOAD (HIDDEN INITIALLY) -->
  <div id="bikeRCBox" style="display:none;">
    <label>Upload Bike RC Photo</label>
    <input type="file" id="bikeRCPhoto" accept="image/*">
  </div>

  <button type="button" class="booking-btn" onclick="openSummary()" style="position:relative; z-index:10;">
    Proceed to Payment
  </button>
  <div class="field-error" id="error"></div>


  </form>
  </div>

  <!-- CALENDAR POPUP -->
  <div id="calendarPopup" class="qr-popup">
    <div class="qr-box" style="width:300px; padding:20px;">

      <h3 style="margin-bottom:10px;">Select a Date</h3>

      <input type="date" id="calendarInput" style="
      width:100%; padding:10px; 
      background:#111; color:#ffd700; 
      border:1px solid rgba(255,215,0,0.4); 
      border-radius:8px; font-size:16px;">

      <button onclick="saveCalendarDate()" class="qr-confirm-btn" style="margin-top:15px;">Confirm</button>
      <button onclick="closeCalendar()" class="qr-close-btn">Close</button>

    </div>
  </div>





  <!-- SUMMARY POPUP -->
  <div id="summaryPopup" class="qr-popup">
    <div class="qr-box" style="width:300px;">
      <h3>Booking Summary</h3>

      <p>Price per Day: <b id="sPrice"></b></p>
      <p>Total Duration: <b id="sDays"></b></p>

      <p>Delivery Charge: <b id="sDelivery"></b></p>
      <p id="sDeposit" style="display:none;">
        Security Deposit: <b id="sDepositAmount"></b>
      </p>
      <hr style="border-color:rgba(255,215,0,0.3); margin:10px 0;">
      <!-- OFFER SECTION -->
      <div id="summaryOfferBox" style="
          margin-top:15px;
          padding:12px;
          border:1px dashed rgba(255,215,0,0.5);
          border-radius:12px;
          display:none;
          ">
        <p style="color:#ffd700;font-weight:600;">üéâ Available Offer</p>

        <p id="summaryOfferText" style="color:#eee;font-size:14px;"></p>

        <button onclick="applyAdminOffer()" class="qr-confirm-btn" style="margin-top:8px;font-size:14px;">
          Apply Offer
        </button>

        <p id="couponMsg" style="margin-top:6px;font-size:13px;"></p>
      </div>


      <p style="font-size:18px;">Total Amount: <b id="sTotal" style="color:#ffd700;"></b></p>

      <button onclick="showQRfromSummary()" class="qr-confirm-btn">Proceed to Pay</button>
      <button onclick="closeSummary()" class="qr-close-btn">Close</button>
    </div>
  </div>

  <!-- QR POPUP -->
  <div id="qrPopup" class="qr-popup">
    <div class="qr-box qr-payment-box">

      <h3 class="qr-title">Scan & Pay ‚Çπ500 & Upload Screenshot</h3>


      <div class="qr-image-wrapper">
        <img id="paymentQR" alt="Payment QR">

      </div>

      <p class="qr-instruction">
        After payment

      </p>

      <label style="color:#ffd700;font-weight:600;display:block;margin-bottom:8px;">
        Upload Payment Screenshot
      </label>

      <input type="file" id="paymentProof" name="paymentProof" accept="image/*" required style="
    width:100%;
    padding:12px;
    border-radius:12px;
    border:1px solid rgba(255,215,0,0.4);
    background:rgba(0,0,0,0.6);
    color:#ffd700;
    margin-bottom:15px;
  ">


      <button id="confirmBookingBtn" onclick="confirmBooking()" class="qr-confirm-btn">
        Confirm Booking
      </button>

      <button onclick="closeQR()" class="qr-close-btn">
        Close
      </button>

    </div>
  </div>


  <!-- TOAST MESSAGE -->
  <div id="toast" style="
  position: fixed;
  bottom: 25px;
  left: 50%;
  transform: translateX(-50%);
  min-width: 280px;
  max-width: 90%;
  padding: 14px 18px;
  border-radius: 14px;
  font-weight: 600;
  text-align: center;
  display: none;
  z-index: 9999;
  backdrop-filter: blur(12px);
"></div>

  <script>

    window.aadhaarVerified = false;
    window.licenseVerified = false;

    let aadhaarProcessing = false;
    let licenseProcessing = false;


    const fullname = document.getElementById("fullname");
    const emailEl = document.getElementById("email");
    const contact = document.getElementById("contact");
    const address = document.getElementById("address");
    const visitPlace = document.getElementById("visitPlace");

    const pickupDate = document.getElementById("pickupDate");
    const pickupTime = document.getElementById("pickupTime");
    const returnDate = document.getElementById("returnDate");
    const returnTime = document.getElementById("returnTime");

    const deliveryAddress = document.getElementById("deliveryAddress");

    const summaryPopup = document.getElementById("summaryPopup");
    const sPrice = document.getElementById("sPrice");
    const sDays = document.getElementById("sDays");
    const sDelivery = document.getElementById("sDelivery");
    const sTotal = document.getElementById("sTotal");
    const sDeposit = document.getElementById("sDeposit");
    const sDepositAmount = document.getElementById("sDepositAmount");
    const bikeRCPhoto = document.getElementById("bikeRCPhoto");


    function showFieldError(inputId, message) {
      const input = document.getElementById(inputId);
      const errorBox = document.getElementById("error-" + inputId);

      if (!input || !errorBox) return;

      // highlight field
      input.classList.add("input-error");

      // show error text
      errorBox.innerText = message;
      errorBox.style.display = "block";

      // auto-scroll to field
      input.scrollIntoView({
        behavior: "smooth",
        block: "center"
      });

      input.focus();
    }


    function clearFieldError(inputId) {
      const input = document.getElementById(inputId);
      const errorBox = document.getElementById("error-" + inputId);

      if (!input || !errorBox) return;

      input.classList.remove("input-error");
      errorBox.innerText = "";
      errorBox.style.display = "none";
    }


    function clearErrors() {
      document.querySelectorAll(".input-error").forEach(el => {
        el.classList.remove("input-error");
      });

      document.querySelectorAll(".field-error").forEach(err => {
        err.innerText = "";
        err.style.display = "none";
      });
    }


    // FULL NAME ‚Äì Only alphabets + spaces
    document.getElementById("fullname").addEventListener("input", function () {
      this.value = this.value.replace(/[^A-Za-z ]/g, "");
    });

    document.getElementById("email").addEventListener("blur", function () {
      this.value = this.value
        .trim()
        .toLowerCase()
        .replace(/\s+/g, "");
    });

    // CONTACT NUMBER ‚Äì Only digits (0-9)
    document.getElementById("contact").addEventListener("input", function () {
      this.value = this.value.replace(/[^0-9]/g, "");

      // Optional: Limit to 10 digits
      if (this.value.length > 10) {
        this.value = this.value.slice(0, 10);
      }
    });











    function resetConfirmButton() {
      const btn = document.getElementById("confirmBookingBtn");
      btn.innerText = "Confirm Booking";
      btn.style.background = "";
      btn.style.color = "";
      btn.disabled = false;
      btn.style.cursor = "pointer";
    }






    async function confirmBooking() {



      const btn = document.getElementById("confirmBookingBtn");
      btn.innerText = "Confirming...";
      btn.disabled = true;

      const paymentImage = document.getElementById("paymentProof").files[0];
      if (!paymentImage) {
        showToast("Please upload payment screenshot", "info");
        resetConfirmButton();
        return;

      }

      const depositType =
        document.querySelector('input[name="depositType"]:checked')?.value;

      if (!depositType) {
        showToast("Select security deposit option", "error");
        resetConfirmButton();
        return;
      }

      if (depositType === "bike") {
        const rcFile = document.getElementById("bikeRCPhoto").files[0];
        if (!rcFile) {
          showToast("Bike RC is required", "error");
          resetConfirmButton();
          return;
        }
      }

      const form = new FormData();

      // BASIC DETAILS
      form.append("fullname", fullname.value.trim());

      form.append("carId", localStorage.getItem("selectedCar"));
      const safeEmail = emailEl.value
        .trim()
        .toLowerCase()
        .replace(/\s+/g, "");

      form.append("email", safeEmail);
      // ‚úÖ FIX HERE

      form.append("contact", contact.value);
      form.append("address", address.value);
      form.append("visitPlace", visitPlace.value);

      // PICKUP
      const pickupMethod = document.getElementById("pickupMethod").value;
      form.append("pickupMethod", pickupMethod);
      if (pickupMethod === "delivery") {
        form.append("deliveryAddress", deliveryAddress.value);
      }

      form.append("pickupDate", pickupDate.value);
      form.append("pickupTime", pickupTime.value);
      form.append("returnDate", returnDate.value);
      form.append("returnTime", returnTime.value);

      // FILES
      form.append("paymentProof", paymentImage);
      form.append("license", document.getElementById("license").value);

      form.append("aadharPhoto", aadhaarFrontFile);
      form.append("aadharPhoto", aadhaarBackFile);


      form.append(
        "licensePhoto",
        document.getElementById("licensePhoto").files[0]
      );

      // üîê DEPOSIT
      form.append("depositType", depositType);

      let depositAmount = 0;
      if (depositType === "cash") {
        depositAmount = 10000;
      } else {
        form.append(
          "bikeRCPhoto",
          document.getElementById("bikeRCPhoto").files[0]
        );
      }

      // üí∞ AMOUNTS (üî• THIS WAS MISSING BEFORE)
      const totalAmount =
        Number(localStorage.getItem("bookingTotalAmount")) || 0;

      const advancePaid = 500;
      const remainingAmount = totalAmount - advancePaid;

      form.append("totalAmount", totalAmount);
      form.append("advancePaid", advancePaid);
      form.append("remainingAmount", remainingAmount);
      form.append("depositAmount", depositAmount);

      // OFFER
      form.append("offerId", window.appliedOfferId || "");
      form.append("discountAmount", Number(window.discountAmount) || 0);

      try {
        const res = await fetch(
          "https://goridezz-backend.onrender.com/api/bookings",
          {
            method: "POST",
            body: form
          }
        );

        const data = await res.json();

        if (res.ok && data.success) {
          // üî• SAVE BOOKING ID FOR REVIEW
          localStorage.setItem("lastBookingId", data.booking._id);

          showToast("Booking successful!", "success");

          // redirect to review page
          window.location.href = "review.html";
        }
        else {
          showToast(data.message || "Booking failed", "error");
          resetConfirmButton();
        }
      } catch (err) {
        console.error(err);
        showToast("Server not reachable. Try again.", "error");
        resetConfirmButton();
      }

    }




    function toggleDeliveryInput() {
      const method = document.getElementById("pickupMethod").value;
      const box = document.getElementById("deliveryAddressBox");

      if (method === "delivery") {
        box.style.display = "block";
      } else {
        box.style.display = "none";
      }
    }

    let activeDateInput = null;

    function openCalendar(inputID) {
      activeDateInput = inputID;
      const cal = document.getElementById("calendarInput");
      cal.min = new Date().toISOString().split("T")[0];
      document.getElementById("calendarPopup").style.display = "flex";
    }


    function closeCalendar() {
      document.getElementById("calendarPopup").style.display = "none";
    }

    function saveCalendarDate() {
      const selected = document.getElementById("calendarInput").value;
      if (!selected) {
        showToast("Please select a date", "info");

        return;
      }

      document.getElementById(activeDateInput).value = selected;
      closeCalendar();
    }

    function openSummary() {
      clearErrors();

      // PRICE
      const rawPrice = localStorage.getItem("selectedCarPrice");
      const pricePerDay = Number(rawPrice);
      if (!rawPrice || isNaN(pricePerDay) || pricePerDay <= 0) {
        showToast("Car price missing. Please reselect the car.");
        return;
      }

      // NAME
      if (!fullname.value.trim()) {
        showFieldError("fullname", "Full name is required");

        return;
      }

      // EMAIL
      const email = document.getElementById("email").value.trim();
      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      if (!email) {
        showFieldError("email", "Email address is required");

        return;
      }

      if (!emailPattern.test(email)) {
        showFieldError("email", "Please enter a valid email address");
        return;
      }

      // CONTACT
      if (contact.value.length !== 10) {
        showFieldError("contact", "Contact number must be 10 digits",);
        return;
      }

      // ADDRESS
      if (!address.value.trim()) {
        showFieldError("address", "Permanent address is required");
        return;
      }

      // VISIT PLACE
      if (!visitPlace.value.trim()) {
        showFieldError("visitPlace", "Please enter your travel destination");
        return;
      }



      // PICKUP METHOD
      const pickupMethod = document.getElementById("pickupMethod").value;

      if (!pickupMethod) {
        showFieldError("pickupMethod", "Please select pickup method");
        return;
      }

      if (pickupMethod === "delivery" && !deliveryAddress.value.trim()) {
        showFieldError("deliveryAddress", "Delivery address is required");
        return;
      }
      if (returnDate.value < pickupDate.value) {
        showFieldError("returnDate", "Return date cannot be before pickup date");
        return;
      }

      // DATES
      if (!pickupDate.value) {
        showFieldError("pickupDate", "Pickup date is required");
        return;
      }

      if (!pickupTime.value) {
        showFieldError("pickupTime", "Pickup time is required");
        return;
      }

      if (!returnDate.value) {
        showFieldError("returnDate", "Return date is required");
        return;
      }

      if (!returnTime.value) {
        showFieldError("returnTime", "Return time is required");
        return;
      }

      // DEPOSIT
      const depositCheck = document.querySelector('input[name="depositType"]:checked');
      if (!depositCheck) {
        showFieldError("depositType", "Please select a security deposit option");
        return;
      }

      if (depositCheck.value === "bike" && !bikeRCPhoto.files.length) {
        showFieldError("bikeRCPhoto", "Bike RC photo is required for bike deposit");
        return;
      }

      // ‚úÖ ALL VALID ‚Üí CONTINUE EXISTING LOGIC
      calculateAndShowSummary(pricePerDay);
    }

    function calculateAndShowSummary(pricePerDay) {

      const pickupTime24 = pickupTime.value;   // "14:30"
      const returnTime24 = returnTime.value;   // "18:00"

      const start = new Date(`${pickupDate.value}T${pickupTime24}:00`);
      const end = new Date(`${returnDate.value}T${returnTime24}:00`);


      if (isNaN(start) || isNaN(end) || end <= start) {
        showToast("Return time must be after pickup time");
        return;
      }

      // ‚è± TOTAL HOURS
      const totalHours = Math.ceil((end - start) / (1000 * 60 * 60));

      // üìÖ BASE DAYS
      let fullDays = Math.floor(totalHours / 24);

      // ‚è≥ EXTRA HOURS
      let extraHours = totalHours % 24;

      // üí∞ PRICING LOGIC
      let extraHourAmount = 0;

      // üî• RULE: If extra hours >= 9 ‚Üí count as 1 full day
      if (extraHours >= 10) {
        fullDays += 1;
        extraHours = 0;
      }
      // üî• ELSE: charge per hour
      else {
        extraHourAmount = extraHours * 200;
      }

      // üí∞ FINAL RENT
      const dayAmount = fullDays * pricePerDay;
      const rentAmount = dayAmount + extraHourAmount;


      const pickupMethodValue = document.getElementById("pickupMethod").value;
      const deliveryCharge = pickupMethodValue === "delivery" ? 500 : 0;

      let depositAmount = 0;
      if (document.querySelector('input[name="depositType"]:checked').value === "cash") {
        depositAmount = 10000;
        sDeposit.style.display = "block";
        sDepositAmount.innerText = "‚Çπ10000";
      } else {
        sDeposit.style.display = "none";
      }

      const total = rentAmount + deliveryCharge + depositAmount;

      // üîê STORE VALUES
      window.rentAmount = rentAmount;
      window.deliveryCharge = deliveryCharge;
      window.depositAmount = depositAmount;
      window.originalTotal = total;
      window.bookingDays = fullDays;

      localStorage.setItem("bookingTotalAmount", total);

      // üñ• UI UPDATE
      sPrice.innerText = `‚Çπ${pricePerDay} / day`;
      sDays.innerText =
        `${fullDays} day(s)` +
        (extraHours > 0 ? ` + ${extraHours} hour(s) (‚Çπ${extraHours * 200})` : "");


      sDelivery.innerText = "‚Çπ" + deliveryCharge;
      sTotal.innerText = "‚Çπ" + total;

      summaryPopup.style.display = "flex";
    }

    function closeSummary() {
      document.getElementById("summaryPopup").style.display = "none";
    }
    function showQRfromSummary() {
      console.log("Proceed to Pay clicked");
      document.getElementById("summaryPopup").style.display = "none";
      showQR();
    }

    async function showQR() {
      const qrImg = document.getElementById("paymentQR");

      try {
        const res = await fetch(
          "https://goridezz-backend.onrender.com/api/qr/qr",
          { cache: "no-store" }
        );

        const base64 = await res.text();
        qrImg.src = base64;   // ‚úÖ THIS IS THE KEY

        document.getElementById("qrPopup").style.display = "flex";

      } catch (err) {
        showToast("Failed to load payment QR", "error");
      }
    }


    function closeQR() {
      document.getElementById("qrPopup").style.display = "none";
    }


    const licenseInput = document.getElementById("license");

    licenseInput.addEventListener("input", function () {
      let v = this.value.toUpperCase();

      // Remove invalid characters
      v = v.replace(/[^A-Z0-9]/g, "");

      // Auto formatting
      let formatted = "";

      if (v.length <= 2) {
        formatted = v;                           // MH
      }
      else if (v.length <= 4) {
        formatted = v.slice(0, 2) + " " + v.slice(2); // MH 12
      }
      else if (v.length <= 8) {
        formatted = v.slice(0, 2) + " " + v.slice(2, 4) + " " + v.slice(4); // MH 12 2024
      }
      else {
        formatted =
          v.slice(0, 2) + " " +
          v.slice(2, 4) + " " +
          v.slice(4, 8) + " " +
          v.slice(8); // MH 12 2024 0037233
      }

      this.value = formatted;

      // Remove spaces for pattern checking
      let clean = v;

      // Validation pattern
      const dlPattern = /^[A-Z]{2}[0-9]{2}(19|20)[0-9]{2}[0-9]{6,7}$/;

      if (dlPattern.test(clean)) {
        this.style.border = "2px solid #00ff7f";  // VALID
      } else {
        this.style.border = "2px solid red";      // INVALID
      }
    });






    /* Draw hours around center of circle */






    function toggleDotsMenu() {
      const menu = document.getElementById("dotsMenu");
      menu.style.display = menu.style.display === "flex" ? "none" : "flex";
    }

    document.addEventListener("click", function (event) {
      const menu = document.getElementById("dotsMenu");
      const button = document.querySelector(".menu-dots");

      if (!menu.contains(event.target) && !button.contains(event.target)) {
        menu.style.display = "none";
      }
    });


    // ===== PREFILL DATES COMING FROM CARS PAGE =====
    window.addEventListener("load", function () {
      const pickupDateLS = localStorage.getItem("pickupDate");
      const pickupTimeLS = localStorage.getItem("pickupTime");
      const returnDateLS = localStorage.getItem("returnDate");
      const returnTimeLS = localStorage.getItem("returnTime");
      const carId = localStorage.getItem("selectedCar");

      if (pickupDateLS) document.getElementById("pickupDate").value = pickupDateLS;
      if (pickupTimeLS) document.getElementById("pickupTime").value = pickupTimeLS;

      if (returnDateLS) document.getElementById("returnDate").value = returnDateLS;
      if (returnTimeLS) document.getElementById("returnTime").value = returnTimeLS;

      if (carId && document.getElementById("carId")) {
        document.getElementById("carId").value = carId;
      }
    });


    function applyAdminOffer() {
      if (!window.activeOffer) return;

      const couponMsg = document.getElementById("couponMsg");

      if (window.bookingDays < activeOffer.minDays) {
        couponMsg.innerText =
          `‚ùå Offer valid only for ${activeOffer.minDays}+ days`;
        couponMsg.style.color = "red";
        return;
      }

      let discount = 0;

      if (activeOffer.discountType === "PERCENT") {
        discount = Math.round(
          window.rentAmount * activeOffer.discountValue / 100
        );
      } else {
        discount = activeOffer.discountValue;
      }

      if (discount > window.rentAmount) {
        discount = window.rentAmount;
      }

      const finalTotal =
        (window.rentAmount - discount) +
        window.deliveryCharge +
        window.depositAmount;

      window.discountAmount = discount;
      window.appliedOfferId = activeOffer._id;

      document.getElementById("sTotal").innerText = "‚Çπ" + finalTotal;

      couponMsg.innerText = `‚úÖ Offer Applied (‚àí‚Çπ${discount} on rent)`;
      couponMsg.style.color = "#00ff7f";

      localStorage.setItem("bookingTotalAmount", finalTotal);
    }

    async function loadActiveOffer() {
      const res = await fetch("https://goridezz-backend.onrender.com/api/offers/active");
      const data = await res.json();

      if (data.offer) {
        activeOffer = data.offer;
        showOfferUI(data.offer);
      }
    }

    window.addEventListener("load", loadActiveOffer);

    function showOfferUI(offer) {
      const box = document.getElementById("summaryOfferBox");
      const text = document.getElementById("summaryOfferText");

      if (!box || !text) return;

      box.style.display = "block";

      text.innerHTML = `
    <b>${offer.title}</b><br>
    ${offer.discountType === "PERCENT"
          ? offer.discountValue + "% OFF"
          : "‚Çπ" + offer.discountValue + " OFF"}
    <br>
    <span style="font-size:12px;color:#ccc">
      Min ${offer.minDays} days booking
    </span>
  `;
    }


    function toggleDeposit() {
      const selected = document.querySelector('input[name="depositType"]:checked');
      const rcBox = document.getElementById("bikeRCBox");

      if (!selected) return;

      if (selected.value === "bike") {
        rcBox.style.display = "block";
      } else {
        rcBox.style.display = "none";
      }
    }

    function showToast(message, type = "error") {
      const toast = document.getElementById("toast");

      let bg = "rgba(255,0,0,0.15)";
      let border = "rgba(255,0,0,0.5)";
      let color = "#ff6b6b";

      if (type === "success") {
        bg = "rgba(0,255,127,0.15)";
        border = "rgba(0,255,127,0.5)";
        color = "#00ff7f";
      }

      if (type === "info") {
        bg = "rgba(255,215,0,0.15)";
        border = "rgba(255,215,0,0.5)";
        color = "#ffd700";
      }

      toast.innerText = message;
      toast.style.background = bg;
      toast.style.border = `1px solid ${border}`;
      toast.style.color = color;
      toast.style.display = "block";

      clearTimeout(window.toastTimer);
      window.toastTimer = setTimeout(() => {
        toast.style.display = "none";
      }, 3000);
    }

    let aadhaarFrontFile = null;
    let aadhaarBackFile = null;

    function handleAadhaarFront() {
      window.aadhaarVerified = false;
      document.getElementById("aadhaarStatus").innerText = "";

      // üîì UNLOCK (in case user re-uploads)
      document.getElementById("aadhaarFront").disabled = false;
      document.getElementById("aadhaarBack").disabled = false;

      const frontInput = document.getElementById("aadhaarFront");
      const msg = document.getElementById("aadhaarFrontMsg");
      const btn = document.getElementById("addBackBtn");

      if (!frontInput.files.length) return;

      aadhaarFrontFile = frontInput.files[0];

      msg.innerText = "‚úÖ Aadhaar FRONT uploaded. Please add BACK photo.";

      btn.style.display = "block";
    }

    function openAadhaarBack() {
      document.getElementById("aadhaarBack").click();
    }

    


  </script>




</body>

</html>